#!/usr/bin/env ruby

require 'redis_alerting'
require 'slop'
require 'daemons'

daemon_opts = {
  monitor: true,
  multiple: false,
  log_output: true,
  log_dir: "/tmp"
}
end

Daemons.run_proc("redis_alerting", daemon_opts ) do
  opts = Slop.parse slop_args do
    on :c, :config=, 'Configuration File'
    on :p, :pwd=, "Working directory"
  end

  begin
    RedisAlerting.run(opts.to_hash)
  rescue ArgumentError => e
    abort "ERROR: #{e.message}"
  end
end